/*! wsu-spine 0.1.0 2014-02-17 */
/*  See https://github.com/washingtonstateuniversity/WSU-spine/ for full source.*/
!function(a){"use strict";a.widget("ui.autosearch",a.ui.autocomplete,{_renderMenu:function(b,c){var d=this,e=c.filter(function(a,b){return"false"==a.related?b:void 0}),f=c.filter(function(a,b){return"false"!=a.related?b:void 0});a.each(e,function(a,c){d._renderItemData(b,c)}),this.options.showRelated&&f.length&&(this.options.relatedHeader&&d._renderHeader(b,this.options.relatedHeader),a.each(f,function(a,c){d._renderItemData(b,c)}))},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-autocomplete-item",b)},_renderItem:function(b,c){var d=c.label,e=c.value,f="(?![^&;]+;)(?!<[^<>]*)("+a.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)";return d="<a href='"+e+"'>"+d.replace(new RegExp(f,"gi"),"<strong>$1</strong>")+"</a>",a("<li></li>").data("item.autocomplete",c).append(d).appendTo(b)},_renderHeader:function(b,c){return a("<li></li>").append("<a href=''>"+c+"</a>").appendTo(b)}})}(jQuery),function(a){"use strict";function b(){var b="";a("#wsu-search input[type=text]").autosearch({source:function(c,d){b=c.term,a.ajax({url:"http://search.wsu.edu/2013service/searchservice/search.asmx/AZSearch",dataType:"jsonp",data:{featureClass:"P",style:"full",maxRows:12,name_startsWith:c.term},success:function(b){var e=new RegExp(a.ui.autocomplete.escapeRegex(c.term),"i");d(a.map(b,function(a){var b=a.label;return a.value&&(!c.term||e.test(b))||"true"==a.related?{label:a.label,value:a.value,searchKeywords:a.searchKeywords,related:a.related}:void 0}))}})},search:function(){},appendTo:"#spine-shortcuts",showRelated:!0,relatedHeader:"<hr/>",minLength:2,select:function(b,c){c.item.searchKeywords,c.item.label;a("#indices").empty(),a("#wsu-search input#searchterm[type=text]").autocomplete("close")},focus:function(){},open:function(){}}).data("autocomplete")}a(document).ready(function(){function c(){window.print()}function d(){a("html").toggleClass("print"),a(".print-controls").remove()}function e(b){void 0!==b&&b.preventDefault(),j.find(".opened").toggleClass("opened closed"),a("html").toggleClass("print"),k.find("header").prepend(B),k.find(".unshelved").removeClass("unshelved").addClass("shelved"),a("#print-invoke").on("click",function(){window.print()}),a("#print-cancel").on("click",d),setTimeout(function(){c()},400)}function f(){var b=a(window).width();b>=1188?a("#jacket").removeClass("size-small size-medium size-large size-xlarge size-lt-xlarge size-lt-large size-lt-medium size-lt-smallish size-gt-large size-gt-medium size-gt-smallish size-gt-small").removeClass("size-small size-medium size-large size-xlarge size-lt-xlarge size-lt-large size-lt-medium size-lt-smallish size-gt-large size-gt-medium size-gt-smallish size-gt-small").addClass("size-xlarge size-gt-small size-gt-smallish size-gt-medium size-gt-large"):b>=990?a("#jacket").removeClass("size-small size-medium size-large size-xlarge size-lt-xlarge size-lt-large size-lt-medium size-lt-smallish size-gt-large size-gt-medium size-gt-smallish size-gt-small").addClass("size-large size-lt-xlarge size-gt-small size-gt-smallish size-gt-medium"):990>b&&b>=792?a("#jacket").removeClass("size-small size-medium size-large size-xlarge size-lt-xlarge size-lt-large size-lt-medium size-lt-smallish size-gt-large size-gt-medium size-gt-smallish size-gt-small").addClass("size-medium size-lt-xlarge size-lt-large size-gt-smallish size-gt-small"):b>=694&&792>b&&a("#binder").hasClass("fixed")?a("#jacket").removeClass("size-small size-medium size-large size-xlarge size-lt-xlarge size-lt-large size-lt-medium size-lt-smallish size-gt-large size-gt-medium size-gt-smallish size-gt-small").addClass("size-smallish size-lt-medium size-lt-large size-lt-xlarge size-gt-small"):792>b?a("#jacket").removeClass("size-small size-medium size-large size-xlarge size-lt-xlarge size-lt-large size-lt-medium size-lt-smallish size-gt-large size-gt-medium size-gt-smallish size-gt-small").addClass("size-small size-lt-smallish size-lt-medium size-lt-large size-lt-xlarge"):396>b&&a("#jacket").removeClass("size-small size-medium size-large size-xlarge size-lt-xlarge size-lt-large size-lt-medium size-lt-smallish size-gt-large size-gt-medium size-gt-smallish size-gt-small").addClass("size-small size-lt-small size-lt-smallish size-lt-medium size-lt-large size-lt-xlarge")}function g(){a(".equalize").length&&(a(".row.equalize .column").css("min-height",""),a(".row.equalize").each(function(){var b=0;a(".column",this).each(function(){a(this).height()>b&&(b=a(this).outerHeight())}),a(".column",this).not(".unequaled").css("min-height",b),a("section.equalize .column",this).css("min-height","auto")}))}function h(){var b=(a("main").offset().top,a(window).height());if(a("#binder").hasClass("size-lt-large"))var c=b-50;else var c=b;a("main.fill-window-height").css("min-height",c)}var i=window.location.href,j=a("#wsu-actions"),k=a("#spine"),l=a("#wsu-search"),m=(a("#wsu-contact"),a("#wsu-share"));if(a("#glue > header").append('<button id="shelve"></button>'),a("#shelve").click(function(){k.toggleClass("unshelved shelved")}),!l.length){var n='<section id="wsu-search" class="spine-search tools closed" data-default="site-search">';n+='		<form id="default-search">',n+='			<input name="term" type="text" value="" placeholder="search">',n+="			<button>Submit</button>",n+="		</form>",n+='		<div id="spine-shortcuts"></div>',n+="</section>",j.append(n),a("#wsu-search form").submit(function(){var b=a("#wsu-search").attr("data-default");if("site-search"==b)var c=" site:"+location.hostname;else var c="";var d="cx=004677039204386950923:xvo7gapmrrg",e="cof=FORID%3A11",f=a("#wsu-search input").val(),g="http://search.wsu.edu/default.aspx?"+d+"&"+e+"&q="+f+c;return window.location.href=g,!1})}if(!m.length){if(a("meta.share-text").length)var o=a("meta.share-text");else o="You should know ...";var p='<section id="wsu-share" class="spine-share tools closed">';p+="	<ul>",p+='		<li class="by-facebook"><a href="http://www.facebook.com/sharer/sharer.php?u='+i+'">Facebook</a></li>',p+='		<li class="by-twitter"><a href="https://twitter.com/intent/tweet?text='+o+"&url="+i+'&via=wsupullman" target="_blank">Twitter</a></li>',p+='		<li class="by-email"><a href="mailto:?subject='+o+"&body="+i+'">Email</a></li>',p+='		<!--<li class="by-gmail"><a href="https://plusone.google.com/_/+1/confirm?hl=en&url='+i+'">Google+</a></li>-->',p+='		<!--<li class="by-linkedin"><a href="http://www.linkedin.com/shareArticle?mini=true&url='+i+'&title=articleTitle&summary=articleSummary&source=articleSource">LinkedIn</a></li>-->',p+='		<!--<li class="by-pinterest"><a href="http://pinterest.com/pin/create/button/?url=""title="Pinterest">Pinterest</a></li>-->',p+="	</ul>",p+="</section>",j.append(p)}if(!a("#wsu-contact").length){var q=a('meta[itemprop="name"]').attr("content"),r=a('meta[itemprop="department"]').attr("content"),s=a('meta[itemprop="url"]').attr("content"),t=a('meta[itemprop="streetAddress"]').attr("content"),u=a('meta[itemprop="addressLocality"]').attr("content"),v=a('meta[itemprop="postalCode"]').attr("content"),w=a('meta[itemprop="telephone"]').attr("content"),x=a('meta[itemprop="email"]').attr("content"),y=a('meta[itemprop="ContactPoint"]').attr("title"),z=a('meta[itemprop="ContactPoint"]').attr("content"),A='<section id="wsu-contact" class="spine-contact tools closed">';A+='<address itemscope itemtype="http://schema.org/Organization" class="hcard">',A+='	<div class="organization-unit fn org"><a href="'+s+'" class="url">'+r+"</a></div>",A+='	<div class="organization-name">'+q+"</div>",A+='	<div class="address">',A+='		<div class="street-address">'+t+"</div>",A+='		<div class="locality">'+u+' <span class="postalcode">'+v+"</span></div>",A+="	</div>",A+='	<div class="tel"><i class="wsu-icon"></i>'+w+"</div>",A+='	<div class="email" rel="email"><a href="mailto:'+x+'"><i class="wsu-icon"></i>Email us</a></div>',"undefined"!=typeof z&&(A+='	<div class="more"><a href="'+z+'"><i class="wsu-icon"></i>'+y+"</a></div>"),A+="</address>",A+="</section>",j.append(A)}a("#wsu-share-tab button").on("click",function(b){b.preventDefault(),a("#wsu-actions *.opened,#wsu-share,#wsu-share-tab").toggleClass("opened closed")}),a("#wsu-search-tab button").on("click",function(b){b.preventDefault(),a("#wsu-actions *.opened,#wsu-search,#wsu-search-tab").toggleClass("opened closed"),a("#spine section#wsu-search input").focus()}),a("#wsu-contact-tab button").on("click",function(b){b.preventDefault(),a("#wsu-actions *.opened,#wsu-contact,#wsu-contact-tab").toggleClass("opened closed")});var B='<span class="print-controls"><button id="print-invoke">Print</button><button id="print-cancel">Cancel</button></span>';a("#wsu-print-tab button").click(e),a("button.shut").on("click",function(a){a.preventDefault(),j.find(".opened").toggleClass("opened closed")}),a(document).scroll(function(){var b=a(document).scrollTop();b>49?k.not(".unshelved").addClass("scanned"):k.removeClass("scanned")}),a("#spine nav ul,#spine ul").parents("li").addClass("parent"),a("#spine nav li[class*=current], nav li[class*=active]").addClass("active").parents("li").addClass("active"),a("#spine nav li a[class*=current], nav li a[class*=active]").parents("li").addClass("active"),a("#spine .active").not(":has(.active)").addClass("dogeared"),a("#spine nav li.parent > a").on("click",function(b){b.preventDefault(),a(this).parent("li").siblings().removeClass("opened"),a(this).parent("li").toggleClass("opened")}),a("#spine nav li.parent > a").each(function(){var b="Overview";if(a(this).attr("title")){var c=a(this).attr("title").length;c>0&&(b=a(this).attr("title"))}if(a(this).closest(".parent").hasClass("dogeared"))var d="overview dogeared";else var d="overview";var e=a(this).attr("href");"#"!=e&&a(this).parent("li").children("ul").prepend('<li class="'+d+'"><a href="'+e+'">'+b+"</a></li>")}),a("main").on("click swipeleft",function(){k.hasClass("unshelved")&&k.toggleClass("shelved unshelved")}),a(window).on("load resize scroll mouseup touchend",function(){var b=a("#spine footer").height(),c=window.innerHeight-b-50,d=a("#glue").height();d>c?k.removeClass("uncracked").addClass("cracked"):k.removeClass("cracked").addClass("uncracked")}),a(document).scroll(function(){var b=window.innerHeight,c=a(document).scrollTop(),d=a("#glue").height(),e=d-b;c>e?a("#spine.cracked").addClass("scrolled"):a("#spine.cracked").removeClass("scrolled")}),a("nav#spine-sitenav a").filter(function(){return this.hostname&&this.hostname!==location.hostname}).addClass("external"),f(),a(window).resize(function(){f()}),g(),a(window).resize(function(){g()}),h(),a(window).resize(function(){h()}),a(window).on("load resize",function(){var b=a("main");if(a(".unbound").length){var c=b.offset().left,d=b.offset().right,e=a(window).width(),f=b.width(),d=e-b.offset().left;if(d>=f)var g=d-f;else g=0;var h=c+b.width();a(".unbound.recto").css("width",d).css("margin-right",-g),a(".unbound.verso").css("width",h).css("margin-left",-c),a(".unbound.verso.recto").css("width",e)}}),b()})}(jQuery);